{"version":3,"sources":["dnd/dnd.cljs"],"mappings":";;;;AAQA,2BAAA,3BAAOA,8DAAaC;AAApB,AACE,IAAAC,qBAAA,AAAAC,gBAAeF;AAAf,AAAA,GAAA,CAAAC,sBAAA;AAAA;;AAAA,QAAAA,JAAYE;AAAZ,AACE,AAACC,aAAgBD;;AACjB,yCAAA,lCAACE,sBAAOL;;;AAGZ,kBAAA,lBAAOM,4CAASC;AAAhB,AACE,QAAA,gEAAyBA;;AAG3B,AAAA,eAAA,uBAAAC,tCAAOE;AAAP,AAAA,IAAAD,WAAA,AAAA;AAAA,AAAA,QAAAA;KAAA;AAAA,OAAAC,2CAAA,CAAA,UAAA;;;KAAA;AAAA,OAAAA,2CAAA,CAAA,UAAA,MAAA,CAAA,UAAA;;;;AAAA,MAAA,KAAAC,MAAA,CAAA,8DAAA,AAAA;;;;;AAAA,CAAA,6CAAA,7CAAOD,wDAAOE;AAAd,AAAA;;;AAAA,CAAA,6CAAA,7CAAOF,wDAAaE,EAAEA;AAAtB,AAAA;;;AAAA,CAAA,uCAAA,vCAAOF;;AAAP,AAGA,0BAAA,1BAAMG,4DAAYC,GAAGP,IAAIQ;AAAzB,AACE,IAAMA,WAAY,uGAAA,2CAAA,gEAAA,MAAA,oEAAA,oEAAA,iEAAA,oEAAA,reAACC,+QAA+BN,oEAAYA,iEAAWA,oEAAYA,gEAAUA,qBAAOK;IAChGf,cAAY,6CAAA,7CAACiB;IACbC,sBAAY,6CAAA,7CAACD;IACbE,eAAY,6CAAA,7CAACF;IACbG,YAAY,WAAKR;AAAL,AAAQ,iDAAA,1CAACP,sBAAOa;;IAC5BG,UAAY,WAAKT;AAAL,AAAQ,iDAAA,1CAACP,sBAAOa;;IAC5BI,YAAY,WAAKC;AAAL,AACE,AAACxB,yBAAYC;;AACb,GAAM,CAAA,AAAAE,gCAAA,hBAAOiB;AAAb,AACE,mCAAA,nCAACd,sBAAOc;;AACR,IAAAK,qBAAC,AAAA,qFAAQT;AAAT,AAAA,CAAAS,mDAAAA,sDAAAA,LAAeD,kCAAAA;;AAFjB;;AAGA,IAAAE,eAAC,AAAA,iFAAMV;AAAP,AAAA,QAAAU,6CAAAA,gDAAAA,LAAaF,4BAAAA;;IAC3BG,WAAY,WAAKH;AAAL,AACE,oBAAA,AAAArB,gBAAWgB;AAAX;;AAAA,AACE,AAAiBK;;AACjB,GAAM,EAAK,CAAA,QAAA,AAAArB,gBAAOiB,oBAAS,CAAA,AAAAjB,gCAAA,hBAAOF;AAAlC,AACE,WAAA,XAAC2B;AAAD,AAAgB,IAAAC,eAAC,AAAA,qFAAQb;AAAT,AAAA,QAAAa,6CAAAA,gDAAAA,LAAeL,4BAAAA;GAA/B;;AADF;;AAEA,AAACxB,yBAAYC;;AACb,OAACK,sBAAOL,YACN,AAAC2B,WACC;AAAA,AACE,kCAAA,lCAACtB,sBAAOL;;AACR,OAACsB,UAAKC;GACR,AAAA,8FAAaR;;;IACjCc,OAAY,WAAKN;AAAL,AACE,oBAAA,AAAArB,gBAAWgB;AAAX;;AAAA,AACE,AAAiBK;;AACjB,IAAMO,sFAAUP,pCAAE,sCAAA,tCAACQ,pCAAyB,0FAAA,1FAACA;AAA7C,AACE,IAAAC,qBAAC,AAAA,kFAAOjB;AAAR,AAAA,CAAAiB,mDAAAA,kEAAAA,jBAAcT,8CAAAA,5CAAEO,8CAAAA;;AAClB,OAACR,UAAKC;;;IACtBU,YAAY,WAAKV;AAAL,AACE,GAAM,CAAA,AAAArB,gCAAA,hBAAOF;AAAb,AACE,WAAA,XAAC2B;AAAD,AAAgB,IAAAO,eAAC,AAAA,qFAAQnB;AAAT,AAAA,QAAAmB,6CAAAA,gDAAAA,LAAeX,4BAAAA;GAA/B;;AADF;;AAEA,GAAM,CAAA,QAAA,AAAArB,gBAAOiB;AAAb,AACE,IAAAgB,qBAAC,AAAA,qFAAQpB;AAAT,AAAA,CAAAoB,mDAAAA,sDAAAA,LAAeZ,kCAAAA;;AADjB;;AAEA,OAACa,mDAAMjB,aAAQkB;;IAC7BC,YAAY,WAAKf;AAAL,AACE,gEAAA,WAAAgB,3EAACH,mDAAMjB;AAAP,AAAgB,IAAAqB,kBAAA;IAAAC,kBAAO,CAAAF,mBAAA;AAAP,AAAA,SAAAC,kBAAAC,mBAAAD,kBAAAC;;;AAChB,GAAM,CAAA,QAAA,AAAAvC,gBAAOiB;AAAb,AACE,IAAAuB,eAAC,AAAA,qFAAQ3B;AAAT,AAAA,QAAA2B,6CAAAA,gDAAAA,LAAenB,4BAAAA;;AADjB;;;AAtCpB,AAwCE,0CAAA,1CAACoB,sDAAyDvB;;AAC1D,0CAAA,1CAACuB,iDAAoDvB;;AACrD,0CAAA,1CAACuB,oDAAuDtB;;AACxD,0CAAA,1CAACsB,qDAAwDjB;;AACzD,oBAAA,pBAAmBZ,2BAAUe;;AAC7B,oBAAA,pBAAmBf,gCAAemB;;AAClC,oBAAA,pBAAmBnB,gCAAewB;;AAClC,mEAAA,wCAAA,8DAAA,wDAAA,oDAAA,+DAAA,yDAAA,2DAAA,2DAAA,8DAAA,mDAAA,7mBAACM,oCAAS9B,GAAG,AAACR,gBAAQC,goBACPP,wCACAkB,bACAC,yCACAC,RACAC,kBACAC,vFACAI,qBACAG,KACAI,uEACAK;;AAGnB,4BAAA,5BAAMO,gEAAc/B,GAAGP;AAAvB,AACE,IAAMuC,IAAE,AAACf,oCAASjB,GAAG,AAACR,gBAAQC;AAA9B,AACE,AAACwC,uCAAYjC,GAAG,AAACR,gBAAQC;;AACzB,GAAM,GAAA,CAAA,AAAAL,6GAAA,7FAAQ,AAAA,sFAAQ4C;AAAtB,AACE,IAAAE,qBAAC,AAAA,iFAAMF;AAAP,AAAA,CAAAE,mDAAAA,iDAAA,QAAAA,6BAAA;;AADF;;AAEA,6CAAA,7CAACC,yDAA4D,AAAA,4FAAYH;;AACzE,6CAAA,7CAACG,oDAA4D,AAAA,4FAAYH;;AACzE,6CAAA,7CAACG,uDAA4D,AAAA,yFAAUH;;AACvE,6CAAA,7CAACG,wDAA4D,AAAA,4FAAWH;;AACxE,uBAAA,vBAAsBhC,8BAAe,AAAA,kFAAOgC;;AAC5C,uBAAA,vBAAsBhC,mCAAe,AAAA,6FAAYgC;;AACjD,8BAAA,vBAAsBhC,mCAAe,AAAA,6FAAYgC","names":["dnd.dnd/kill-timer!","*timer","temp__5757__auto__","cljs.core/deref","t","js/clearTimeout","cljs.core/reset!","dnd.dnd/dom-key","key","var_args","G__15247","dnd.dnd/noop","js/Error","_","dnd.dnd/subscribe!","el","opts","cljs.core.merge","cljs.core.atom","*ignore?","*enters","dragstart","dragend","end!","e","fexpr__15249","fexpr__15250","dragover","js/setTimeout","fexpr__15251","drop","files","dnd.dnd.goog$module$goog$object.get","fexpr__15252","dragenter","fexpr__15253","fexpr__15254","cljs.core.swap_BANG_","cljs.core/inc","dragleave","p1__15248#","x__4336__auto__","y__4337__auto__","fexpr__15255","js/document.documentElement.addEventListener","dnd.dnd.goog$module$goog$object.set","dnd.dnd/unsubscribe!","s","dnd.dnd.goog$module$goog$object.remove","fexpr__15256","js/document.documentElement.removeEventListener"],"sourcesContent":["(ns dnd.dnd\n  (:require\n    [clojure.string :as str]\n    [goog.object :as gobj]))\n\n; https://github.com/tonsky/cljs-drag-n-drop/blob/master/src/cljs_drag_n_drop/core.cljs\n; file drop, different goal\n\n(defn- kill-timer! [*timer]\n  (when-some [t @*timer]\n    (js/clearTimeout t)\n    (reset! *timer nil)))\n\n\n(defn- dom-key [key]\n  (str \"cljs-drag-n-drop.\" key))\n\n\n(defn- noop ([_]) ([_ _]))\n\n\n(defn subscribe! [el key opts]\n  (let [opts        (merge { :timeout-ms 500 :start noop :enter noop :drop noop :leave noop :end noop } opts)\n        *timer      (atom nil)\n        *ignore?    (atom nil)\n        *enters     (atom 0)\n        dragstart   (fn [_] (reset! *ignore? true))\n        dragend     (fn [_] (reset! *ignore? false))\n        end!        (fn [e]\n                      (kill-timer! *timer)\n                      (when (pos? @*enters)\n                        (reset! *enters 0)\n                        ((:leave opts) e))\n                      ((:end opts) e))\n        dragover    (fn [e]\n                      (when-not @*ignore?\n                        (.preventDefault e)\n                        (when (and (== 0 @*enters) (nil? @*timer))\n                          (js/setTimeout #((:start opts) e) 0))\n                        (kill-timer! *timer)\n                        (reset! *timer\n                          (js/setTimeout\n                            (fn []\n                              (reset! *timer nil)\n                              (end! e))\n                            (:timeout-ms opts)))))\n        drop        (fn [e]\n                      (when-not @*ignore?\n                        (.preventDefault e)\n                        (let [files (-> e (gobj/get \"dataTransfer\") (gobj/get \"files\"))]\n                          ((:drop opts) e files))\n                        (end! e)))\n        dragenter   (fn [e]\n                      (when (nil? @*timer)\n                        (js/setTimeout #((:start opts) e) 0))\n                      (when (== 0 @*enters)\n                        ((:enter opts) e))\n                      (swap! *enters inc))\n        dragleave   (fn [e]\n                      (swap! *enters #(max 0 (dec %)))\n                      (when (== 0 @*enters)\n                        ((:leave opts) e)))]\n    (js/document.documentElement.addEventListener \"dragstart\" dragstart)\n    (js/document.documentElement.addEventListener \"drag\" dragstart)\n    (js/document.documentElement.addEventListener \"dragend\" dragend)\n    (js/document.documentElement.addEventListener \"dragover\" dragover)\n    (.addEventListener el \"drop\" drop)\n    (.addEventListener el \"dragenter\" dragenter)\n    (.addEventListener el \"dragleave\" dragleave)\n    (gobj/set el (dom-key key)\n      { :timer     *timer\n        :ignore?   *ignore?\n        :enters    *enters\n        :dragstart dragstart\n        :dragend   dragend\n        :end       end!\n        :dragover  dragover\n        :drop      drop\n        :dragenter dragenter\n        :dragleave dragleave })))\n\n\n(defn unsubscribe! [el key]\n  (let [s (gobj/get el (dom-key key))]\n    (gobj/remove el (dom-key key))\n    (when (some? @(:timer s))\n      ((:end s) nil))\n    (js/document.documentElement.removeEventListener \"dragstart\" (:dragstart s))\n    (js/document.documentElement.removeEventListener \"drag\"      (:dragstart s))\n    (js/document.documentElement.removeEventListener \"dragend\"   (:dragend s))\n    (js/document.documentElement.removeEventListener \"dragover\"  (:dragover s))\n    (.removeEventListener el \"drop\"      (:drop s))\n    (.removeEventListener el \"dragenter\" (:dragenter s))\n    (.removeEventListener el \"dragleave\" (:dragleave s))))"]}